# Project Shadow Specification

## What is a Project Shadow

A Project Shadow is a dense, authoritative reference document that captures the essential context of a repository for AI collaborators who lack direct repository access.

It is:
- **Committed to the repository** it describes
- **Generated by AI** using a canonical prompt
- **Reviewed by humans** before merge
- **Read by AI** during collaboration sessions

## Problems It Solves

| Problem | How Shadow Addresses It |
|---------|-------------------------|
| AI lacks codebase context | Provides architectural overview and key abstractions |
| AI violates implicit rules | Documents invariants and constraints explicitly |
| AI makes unsafe changes | Identifies landmines and non-obvious failure modes |
| AI proposes out-of-scope work | Defines non-goals and scope boundaries |
| AI misunderstands ownership | Clarifies authority model and decision paths |

## What It Is NOT

- **Not documentation for humans** — assumes expert AI audience
- **Not a tutorial** — no onboarding or explanatory content
- **Not a changelog** — describes current state only
- **Not a roadmap** — no future plans or proposals
- **Not generated at runtime** — static artifact, version-controlled

## Required Sections

A valid Project Shadow contains exactly these sections:

1. **Identity** — Name, purpose, type
2. **Architecture Overview** — Structure and entry points
3. **Core Abstractions** — Types, patterns, data flow
4. **Invariants** — Rules that must never be violated
5. **Contracts and Boundaries** — API surfaces, integration points
6. **Landmines** — Non-obvious failure modes
7. **Non-Goals** — Explicit scope exclusions
8. **Testing Strategy** — Test organization and commands
9. **Development Workflow** — Build, run, iterate
10. **Authority Model** — Ownership and review process

## Regeneration Triggers

Regenerate the Project Shadow when:

- **Architecture changes** — New modules, removed components, restructured directories
- **Invariants change** — New constraints added or old ones removed
- **Contracts change** — Public API modifications, new integration points
- **New landmines discovered** — Non-obvious failure modes identified
- **Scope changes** — Non-goals added or removed

Do NOT regenerate for:
- Bug fixes within existing architecture
- Documentation updates
- Dependency version bumps
- Test additions that don't change strategy

## Ownership and Authority

| Role | Responsibility |
|------|----------------|
| Generator Prompt | Defines structure and constraints — maintained centrally |
| Generated Shadow | Describes target repo — committed to target repo |
| Human Reviewer | Validates accuracy before merge |
| AI Consumer | Reads Shadow for context during collaboration |

The Project Shadow is **descriptive, not prescriptive**. It documents what exists; it does not mandate what should exist.

The human maintainer of the target repository has final authority over Shadow content. AI-generated content must be reviewed before commit.

## Quality Criteria

A well-formed Project Shadow:

- Contains all 10 required sections
- Has no empty or placeholder sections
- States only facts about current implementation
- Contains no opinions, proposals, or speculation
- Includes concrete examples where they add clarity
- Identifies at least 2 invariants, 2 landmines, and 2 non-goals

---

## Delta Shadow Mechanism

### What is a Delta Shadow

A Delta Shadow is a discrete, append-only record of an architectural change that affects the Project Shadow. It captures the before/after state and provides an auditable trail of architectural evolution.

### Storage Layout

Delta Shadows are stored in:
```
docs/ai/deltas/YYYY-MM-DD-short-slug.md
```

Example filenames:
- `2026-01-08-add-auth-subsystem.md`
- `2026-01-15-remove-legacy-api.md`
- `2026-02-01-new-invariant-idempotency.md`

### When to Use Delta Shadow vs Direct Edit

| Scenario | Action |
|----------|--------|
| Typo or formatting fix in Shadow | Edit `PROJECT_SHADOW.md` directly |
| Clarification that doesn't change meaning | Edit `PROJECT_SHADOW.md` directly |
| New invariant discovered | Create Delta Shadow, then merge |
| Architecture boundary changed | Create Delta Shadow, then merge |
| Landmine added or removed | Create Delta Shadow, then merge |
| Non-goal added or removed | Create Delta Shadow, then merge |
| Public API contract changed | Create Delta Shadow, then merge |

### Append-Only Expectation

Once a Delta Shadow is committed:
- It is **never modified**
- It serves as historical record
- The merge into `PROJECT_SHADOW.md` is tracked separately

### Delta Shadow Lifecycle

1. **Generate** — AI or human creates Delta Shadow using `delta-shadow.template.md`
2. **Review** — Human validates accuracy and approves
3. **Commit** — Delta Shadow is committed to `docs/ai/deltas/`
4. **Merge** — Changes are applied to `PROJECT_SHADOW.md`
5. **Archive** — Delta remains in `deltas/` as permanent record
